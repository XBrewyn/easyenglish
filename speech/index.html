<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Speech Recognition</title>
</head>

<body>
  <button id="recordButton">Record</button>
  <button id="stopButton" style="display: none;">Stop</button>
  <div id="output"></div>

  <script>
    const recordButton = document.getElementById('recordButton');
    const stopButton = document.getElementById('stopButton');
    const outputDiv = document.getElementById('output');
    let mediaRecorder;
    const audioChunks = [];

    recordButton.addEventListener('click', startRecording);
    stopButton.addEventListener('click', stopRecording);

    function startRecording() {
      navigator.mediaDevices.getUserMedia({ audio: true })
        .then(stream => {
          mediaRecorder = new MediaRecorder(stream);

          mediaRecorder.addEventListener('dataavailable', event => {
            audioChunks.push(event.data);
          });

          mediaRecorder.addEventListener('stop', () => {
            const audioBlob = new Blob(audioChunks);
            const formData = new FormData();
            formData.append('audio', audioBlob, 'recording.mp3');

            fetch('http://127.0.0.1:5000/recognize', {
              method: 'POST',
              body: formData
            })
              .then(response => response.text())
              .then(text => {
                outputDiv.textContent = text;
              })
              .catch(error => {
                console.error('Error:', error);
              });

            audioChunks.length = 0;
            recordButton.style.display = 'inline';
            stopButton.style.display = 'none';
          });

          mediaRecorder.start();
          recordButton.style.display = 'none';
          stopButton.style.display = 'inline';
        })
        .catch(error => {
          console.error('Error accessing microphone:', error);
        });
    }

    function stopRecording() {
      if (mediaRecorder && mediaRecorder.state !== 'inactive') {
        mediaRecorder.stop();
      }
    }
  </script>
</body>

</html>